<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Corson N. Areshenkoff">
<meta name="dcterms.date" content="2018-09-09">

<title>In a room sit three textbooks… – areshenkBlog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">areshenkBlog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../research.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html"> 
<span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../packages.html"> 
<span class="menu-text">Software</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publications.html"> 
<span class="menu-text">Publications</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/areshenk"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">In a room sit three textbooks…</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Corson N. Areshenkoff </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 9, 2018</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>I’ve argued before that poor statistics education in the sciences is a major contributing factor to scientists’ general lack of understanding of basic statistical concepts. I’m not so much interested in factual inaccuracies, which are inevitable, as the material has to be presented to a largely non-technical audience, but instead with how textbooks go about handling the translation of statistical concepts to a non-technical audience.</p>
<p>Most results in statistics, even very basic ones, have extremely precise statements that require a rigorous understanding of concepts like a <i>random variable</i> or a <i>density function</i>, which usually have mathematical backgrounds beyond the scope of statistics courses in the sciences. This means that these concepts can’t be defined <i>exactly</i> correctly, but have to be given definitions which are close enough to true while still being understandable to students. This isn’t inherently negative – many practitioners of statistics need to develop a working knowledge of a concept or technique without understanding it rigorously, but simplification is a subtle art. For example, how do you simplify a definition in a way that doesn’t cause problems much later, when some subtle part of a definition which was simplified away actually becomes important? What about edge cases where the simplification doesn’t quite hold true? And how do you ensure that students <i>understand</i> that some simplification has occurred, and aren’t tricked into thinking that they understand a concept rigorously.</p>
<p>Take the central limit theorem (CLT) as a illustration.</p>
<div style="padding:12px;background-color:#EEEEEE;line-height:1.4;">
<p><strong>Central limit theorem</strong> Let <span class="math inline">\(x_1,\dots,x_n\)</span> be a random sample from a distribution with finite mean <span class="math inline">\(\mu\)</span> and variance <span class="math inline">\(\sigma^2\)</span>. Then, as <span class="math inline">\(n \rightarrow \infty\)</span>, the following holds: <span class="math display">\[ \sqrt{n}(\bar{X}_n - \mu) \xrightarrow{d} \mathrm{N}(0, \sigma^2) \]</span> Where <span class="math inline">\(\xrightarrow{d}\)</span> denotes convergence in distribution.</p>
</div>
<p>There is a lot to unpack in this definition – convergence in distribution, finiteness of the mean and variance (what does it mean for a distribution to lack a mean or variance?), and the general fuzziness with which distributions and random variables are defined in many statistics courses. This means that, in the sciences, the CLT almost always has to be summarized, rather than stated (much less proved) rigorously. The goal is to give the student some kind of intuition along the lines of “<em>if our data come from some well enough behaved distribution, then then sample mean becomes more and more normal as the sample size increases</em>”, while introducing a minimum of false intuition or other weirdness alongside it. Sometimes this requires saying things that aren’t exactly true, but that give the right intuition, or that are true broadly enough that the student is unlikely to run into trouble. It might also involve neglecting to mention things that <i>are</i> true, if they add needless complexity. I thought it might be interesting to look at a few of the statistics textbooks I’ve seen used in psychology and neuroscience departments, to see how they handle the problem.</p>
<p>A great example of this process done well is found in Navarro’s <em>Learning statistics with R</em></p>
<blockquote class="blockquote">
When talking about probability distributions, we’ve made use of the idea that observations X are sampled from some distribution […] This idea can be extended, to talk about the distribution of a sample statistic […] we should be able to talk about <span class="math inline">\(\bar{X}\)</span> as having a distribution. <cite>Learning statistics with R (Section 10.3, p.&nbsp;300)</cite>
</blockquote>
<blockquote class="blockquote">
The law of large numbers is a very powerful tool, but we can actually make a stronger statement than this, using one of the most useful mathematical results in all of statistics: the central limit theorem. Let’s suppose that the population distribution of <span class="math inline">\(X\)</span> has a mean <span class="math inline">\(\mu\)</span> and standard deviation <span class="math inline">\(\sigma\)</span>, but it’s not a normal distribution. The central limit theorem says that, as the sample size increases, the sampling distribution of the mean <span class="math inline">\(\bar{X}\)</span> will become a normal distribution, with mean <span class="math inline">\(\mu\)</span> and standard deviation <span class="math inline">\(\sigma / \sqrt{N}\)</span>. By convention, the standard deviation of a sampling distribution is called the standard error (SE). Therefore, the standard error of the mean <span class="math inline">\(\bar{X}\)</span>, can be described by the following equation <span class="math display">\[
\mathrm{se}(X) = \frac{\sigma}{\sqrt{N}}
\]</span> <cite>Learning statistics with R (Section 10.4, p.&nbsp;301)</cite>
</blockquote>
<p>This is about the best overview of the CLT you’ll find in an introductory statistics textbook. Note that some details of the theorem aren’t mentioned – for example, the assumption that <span class="math inline">\(X\)</span> has finite first and second moments, which is probably just a distraction at this level. It’s also a bit loose with the actual statement of the theorem, stating that <span class="math inline">\(\bar{X}\)</span> <i>becomes normal</i>, which a student could easily confuse to mean that normality is achieved for some finite <span class="math inline">\(N\)</span>. But <i>Navarro</i> then goes on to clarify these misunderstandings by performing simulations so that the student can actually see what is happening to the distribution of <span class="math inline">\(\bar{X}\)</span> as <span class="math inline">\(n\)</span> increases.</p>
<p>One thing I really like is that the book communicates the gist of the theorem without trying to distill it down to a set of concrete rules (e.g.&nbsp;<i>if the sample size is greater than 30, then we can assume that the distribution is normal</i>), which almost always has the effect of tricking the student into thinking that their loose intuition is more rigorous than it is, simply by virtue of concrete rules <i>seeming</i> more rigorous, subjectively. Instead, the book does simulations from a variety of distributions and explicitly notes the differences in convergence, showing that 1) the behavior of the CLT is context dependent, and 2) the CLT gives an approximation, and we have to choose how much approximation error we are willing to tolerate in practice. Some information is lost in the simplification, but the student comes away with the understanding that there are subtleties which were not discussed, and are not tricked into believing that they understand the theorem fully.</p>
<p>The book does all of this without being condescending – just noting that the full details of the theorem are too complex to be taught in an introductory course, and then moving on with an illustration of what the theorem entails in practice. Many statistics textbooks fall into the trap of assuming that students despise the material and trying to placate them with assurances like “<i>now don’t worry, we won’t make you do any math</i>” or “<i>some super smart people worked out the details, but you only have to worry about X</i>”. I think these kinds of statements are intended to make the material more relatable, but really they just come across as insulting.</p>
<p>Consider this next example, from Mayer’s <i>Introduction to statistics and SPSS in psychology</i>, in many ways the anti-<i>Navarro</i>:</p>
<blockquote class="blockquote">
<p>In statistics, central limit theorem states that the mean of the sampling distribution equals the mean of the population and that the standard error of the mean equals the standard deviation of the population. … So long as distributions are relatively normal, we can use the principles of central limit theorem to make inferences about probability and statistical significance with relatively small samples. But how small is small? In general terms, a sample of 30 or more will probably suffice. However, we can be more precise if we make the effort to find out more about the distribution of our sample. According to central limit theorem, the sample is large enough if any of the following holds true:</p>
<ol type="1">
<li><p>Where the sample size is 15 or less: – a. The distribution must be normally distributed, – b. have no outliers and – c.&nbsp;must be unimodal (have one peak in the curve).</p></li>
<li><p>Where the sample size is between 16 and 40: – a. the distribution must be no more than moderately skewed, – b. have no outliers and – c.&nbsp;must be unimodal.</p></li>
<li><p>Where the sample size is greater than 40: – a. the distribution must have no outliers. <cite>Introduction to statistics and SPSS in psychology (2013; Ch. 4, p.&nbsp;77)</cite></p>
</li></ol></blockquote>

<p>Where to begin. First, the definition is simply wrong. That is not the statement of the central limit theorem, and it’s not even true. The standard error of the mean is most certainly <i>not</i> equal to the standard deviation of the population in general. What’s even more bizarre is that the book <i>knows this</i> – having defined the standard error only pages earlier. Neither does this discussion build any intuition for how the CLT works. Whereas <i>Navarro</i> carefully develops the concept of a sampling distribution, explaining that because the sample is random, anything we <i>compute</i> from the sample is also random, and thus has a distribution, and then shows exactly what this entails through simulation, <i>Mayer</i> gives a confusing attempt at a definition:</p>
<blockquote class="blockquote">
To get a better representation of that population, we could collect data from many samples. This task would be onerous, so we can use statistics to ‘model’ those theoretical samples. We call this a sampling distribution. Had we actually collected all possible samples, each sample would have a different mean and standard deviation. In a sampling distribution, we assume that the mean is the same as it is in the entire population, so long as that population is normally distributed. <cite>Introduction to statistics and SPSS in psychology (2013; Ch. 4, p.&nbsp;73)</cite>
</blockquote>
<p>which offers no intuition for what a sampling distribution is, and includes the bizarre statement “<i>In a sampling distribution, we assume that the mean is the same as it is in the entire population, so long as that population is normally distributed</i>”, which I assume is alluding to the fact that the expected value of the sample mean is equal to the mean of the population, but is phrased in such a strange way that I can’t imagine a student would be able to parse it, given that “sampling distribution” hasn’t even been defined beyond the claim that we somehow use it to model “theoretical samples”. Without making clear that the mean actually has a distribution, the book can’t hope to develop any intuitive understanding of the CLT, so (after giving an incorrect statement of the theorem) the book goes on to list several rules. “<i>According to the central limit theorem, the sample is large enough</i>”, if it has at least 40 observations, but we can get away with 15 if the sample is normal. But then why do we need the CLT? If the sample is normally distributed, the mean is already normal, so we don’t need the CLT at all. Of course, the CLT doesn’t actually provide <i>any</i> of these “rules”. Whereas <i>Navarro</i> is honest that its definition is not rigorous, and instead tries to develop intuition by showing how the CLT works in practice, <i>Mayer</i> gives no intuition at all, and lies to the student by giving a definition and a set of rules that <i>appear</i> to be rigorous, but are actually false.</p>
<p>Another common textbook, Gravetter’s <i>Statistics for the Behavioral Sciences</i> does a little bit better</p>
<blockquote class="blockquote">
<p>[A] mathematical proposition known as the central limit theorem provides a precise description of the distribution that would be obtained if you selected every possible sample, calculated every sample mean, and constructed the distribution of the sample mean. This important and useful theorem serves as a cornerstone for much of inferential statistics. Following is the essence of the theorem</p>
<p><strong>Central limit theorem</strong>: For any population with mean <span class="math inline">\(\mu\)</span> and standard deviation <span class="math inline">\(\sigma\)</span>, the distribution of sample means for sample size <span class="math inline">\(n\)</span> will have a mean of <span class="math inline">\(\mu\)</span> and a standard deviation of <span class="math inline">\(\sigma/\sqrt{n}\)</span> and will approach a normal distribution as <span class="math inline">\(n\)</span> approaches infinity.</p>
<p>The value of this theorem comes from two simple facts. First, it describes the distribution of sample means for any population, no matter what shape, mean, or standard deviation. Second, the distribution of sample means “approaches” a normal distribution very rapidly. By the time the sample size reaches <span class="math inline">\(n = 30\)</span>, the distribution is almost perfectly normal. <cite>Statistics for the Behavioral Sciences (9th ed.&nbsp;Ch. 7, p.&nbsp;205)</cite></p>
</blockquote>
<p>This is…eh. It at least attempts to describe the concept of a sampling distribution, and the statement of the CLT is true-ish, through not nearly as “usefully wrong” as <i>Navarro</i>, which made it clear when it was deviating from the rigorous statement of the theorem, and generally did so only when it was necessary to avoid confusion. Instead, <i>Gravetter</i> confidently states things like “<i>By the time the sample size reaches <span class="math inline">\(n = 30\)</span>, the distribution is almost perfectly normal</i>”, which is both not true and not helpful.</p>
<p>I’ve deliberately avoided mentioning the “significance issue”, since I’m more interested in how textbooks approach the presentation of material to a non-technical audience than I am with misinterpretations of significance testing specifically, but it’s worthwhile to see how each book covers the material. I find that most textbooks present significance testing in a way which is <i>technically</i> correct, but encourages the false intuition that the p-value is somehow a measure of the probability that the observed results are “true”. <i>Gravetter</i> is good about this. It develops the logic of significance testing properly:</p>
<blockquote class="blockquote">
A significant result permits the following conclusion: “This specific sample mean is very unlikely (<span class="math inline">\(p &lt; .05\)</span>) if the null hypothesis is true.” <cite>Statistics for the Behavioral Sciences (9th ed.&nbsp;Ch. 8, p.&nbsp;260)</cite>
</blockquote>
<p>and then devotes an entire section to dispelling the misunderstanding that the p-value quantifies the probability of the null hypothesis. I’d have to say that, despite devoting far too much time to significance testing, which I don’t think is very useful in practice, <i>Gravetter</i> actually covers the logic of significance testing very well. Unfortunately, it falls back into common habits when discussing confidence intervals:</p>
<blockquote class="blockquote">
…we can confidently estimate that the value of the parameter should be located in the interval. <cite>Statistics for the Behavioral Sciences (9th ed.&nbsp;Ch. 9, p.&nbsp;300)</cite>
</blockquote>
<p>On the other hand, <i>Mayer</i> is just a disaster:</p>
<blockquote class="blockquote">
By stating that there is less than 5% probability that an outcome occurred by chance, we are actually saying that there is a less than 5% probability that the null hypothesis is “true”. <cite>Introduction to statistics and SPSS in psychology (2013; Ch. 4, p.&nbsp;68)</cite>
</blockquote>
<p>Absolutely not.</p>
<blockquote class="blockquote">
A key factor to remember with hypothesis testing is that we are dealing with probability, not certainty. Statistics will only tell us the likelihood that the outcome occurred by chance. <cite>Introduction to statistics and SPSS in psychology (2013; Ch. 4, p.&nbsp;70)</cite>
</blockquote>
<p>No no no.</p>
<blockquote class="blockquote">
In this first example we will demonstrate how we can calculate the achieved statistical power, based on outcomes from a completed study. <cite>Introduction to statistics and SPSS in psychology (2013; Ch. 4, p.&nbsp;84)</cite>
</blockquote>
<p>God no. Honestly, I’m a little disturbed to see <i>Mayer</i> released by such a major publisher (Pearson). I find it very difficult to follow, even having a strong background in the material. The book uses terminology in extremely confusing and non-standard ways. For example, it seems to conflate the standard error of the sample mean with the standard deviation of the population, or maybe it uses “population” to mean the distribution of sample means under repeated experiments? It’s hard to tell:</p>
<blockquote class="blockquote">
…the standard error of the mean equals the standard deviation of the population. <cite>Introduction to statistics and SPSS in psychology (2013; Ch. 4, p.&nbsp;77)</cite>
</blockquote>
<blockquote class="blockquote">
As we saw earlier, the population is potentially infinite, so we need to estimate the standard deviation of the population from the standard error. <cite>Introduction to statistics and SPSS in psychology (2013; Ch. 4, p.&nbsp;78)</cite>
</blockquote>
<blockquote class="blockquote">
<strong>Standard Error:</strong> the average variation of scores in a sampling distribution, or the estimated variation in the population. <cite>Introduction to statistics and SPSS in psychology (2013; Ch. 4, p.&nbsp;80)</cite>
</blockquote>
<p>This isn’t a trivial mistake. The standard deviation and standard error are not only not equal, they <i>don’t even quantify the variability of the same distributions</i>. By confusing the concepts of <em>sample</em>, <em>sampling distribution</em>, and <em>population</em>, the book makes it impossible to understand any one of those concepts individually, which makes it impossible to understand any technique that references those concepts.</p>
<p>Finally, <i>Navarro</i> takes the approach of working out a binomial example in painstaking detail <i>before</i> introducing the general concept of significance testing. I like this, since it makes it absolutely clear what is being calculated, and leaves no room for misinterpretation (though later it does very explicitly address the common misinterpretations of significance testing). The book then goes on to describe in detail the conflicting Neyman and Fisher approaches to statistical testing, though I’m not sure if this would help the student or just confuse them.</p>
<p>Though only three, I’d argue that these books give a pretty good idea of the general <i>classes</i> of books that are commonly aimed towards students in the sciences: books which are broadly or technically correct, but don’t really give good intuition, and don’t accurately portray how statistics is done in practice; books which are just plain wrong; and books or lecture notes, almost always independent or open source efforts, which portray the material in a way which is technically correct, and try desperately to convey the right intuition, but still contend with having to inoculate students against bad practices in other books and in the literature. This means that even good books like <i>Nevarro</i> have to waste entire chapters on significance testing just because students have to understand it thoroughly in order to read the literature. To its credit, it relegates the material to a single chapter (<i>Gravetter</i> devotes <strong>three</strong> chapters to the t-test! Why?!), and devotes an entire chapter early on to estimation (the only introductory textbook in the sciences to do so, as far as I know). The remainder of the book is dedicated to regression and ANOVA <i>as models</i>, and not simply as elaborate versions of the t-test, which is great. It’s a very minor point, but <i>Nevarro</i> is also the only book to make a distinction between regression <i>as a model</i> and <i>least-squares estimation</i>. I think this distinction between a statistical model and the technique used to estimate it is actually very important when building intuition for modeling more generally.</p>
<p>I wrote this post out of curiosity, as I wanted to see how statistics was being taught here at Queens, and I ended up picking the first three books I found in stacks of old course outlines. I guess you could interpret this as an endorsement of Nevarro’s <i>Learning statistics with R</i>, but really, I think <i>Nevarro</i> is just the closest you can get to good given the required constraints for statistics courses in fields where statistics just isn’t used very well. I once took a course in Topology taught by the <a href="https://en.wikipedia.org/wiki/Moore_method">Moore method</a>, and the more I think about it, the more I think it’s the only right way to approach data analysis more generally. Give students datasets and have them devise methods to answer questions about them; have other students try to break those methods, or identify boundary cases or limitations; then have them devise ways to test or verify their models. No mass-univariate significance testing silliness would ever survive this kind of Darwinism.</p>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>