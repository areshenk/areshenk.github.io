<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Corson N. Areshenkoff">
<meta name="dcterms.date" content="2018-02-18">

<title>areshenkBlog - Cargo cult statistics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">areshenkBlog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../research.html" rel="" target="">
 <span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html" rel="" target="">
 <span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../packages.html" rel="" target="">
 <span class="menu-text">Software</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publications.html" rel="" target="">
 <span class="menu-text">Publications</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/areshenk" rel="" target=""><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Cargo cult statistics</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Corson N. Areshenkoff </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 18, 2018</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p>The failure of scientists, and particularly students in the sciences, to properly understand the most commonly used statistical concepts in their field has been extensively documented (see e.g.&nbsp;Sotos et al., 2007). Many of the specific misunderstandings are well known at this point to anyone with an interest in methodology – for example, Haller, et al.&nbsp;(2002) questioned students and faculty at several Universities and found that the overwhelming majority could not correctly define a p-value, a crisis that has launched a thousand publications.</p>
<p>I’m not interested in these misunderstandings, because I don’t consider them to be very important. The failure of students and researchers to understand (say) basic hypothesis testing has led to a small cottage industry and several tenured careers spent attempting either to correct the specific misunderstanding, or to take away null hypothesis testing altogether and replace it with something like a Bayes factor. All of these efforts are doomed to fail because they ignore the fundamental problem: these misunderstandings are not isolated gaps in knowledge; they represent a fundamental lack of understanding of basic concepts in statistics and probability.</p>
<p>If we want to understand how these misunderstandings come about, thinking about how students learn statistics can be instructive.</p>
<p>For those who might be unfamiliar with the way that statistics is taught in the natural or behavioural sciences: undergraduate students typically take a department mandated course (or two) in data analysis sometime in their second or third year. Unless their major is highly quantitative, most students do not have a strong background in mathematics. Many will not have taken any math since high school, while others may have taken a required course in “Calculus for non-math majors”. As a result, the course is largely taught by pictures and analogy. Generally, instructors will comfort their students on the first day of class by reassuring them that, although there will be “formulas”, the main goal is for them to understand the “meaning” of the equations, and so gain some form of “intuition” about how to use statistics.</p>
<p>Generally, intuition is something I imagine resulting from a deep understanding of a field or concept, so that a person understands fundamentally how it behaves. How a student can gain an intuition for statistics without solving any statistical problems, or grappling with the central theorems of the field, is beyond my guessing. Intuition comes after technical proficiency, it’s not a replacement for it. This doesn’t mean that every student needs a background in measure theoretic probability, but shouldn’t a researcher who is going to work with statistical models as part of their career compute the expected value of a distribution at least once in their life? I’ve floated this idea by colleagues before, and most of them are strongly opposed to it. They generally respond with some variant of “I don’t need to know the math behind everything, I know it well enough to use it in practice”. I’ve even heard colleagues claim that they don’t think students should take courses in the statistics or mathematics departments because “those courses don’t teach them how to <i>use</i> statistics!”. And yet, here we are. Over 90% of psychology undergraduates cannot correctly interpret a hypothesis test. Apparently they didn’t get much intuition after all.</p>
<p>Some courses may provide an introduction to probability – necessarily discrete, since the instructor can’t assume a background in calculus. This will consist mostly of when you should multiply or add probabilities, and a few examples of Bayes theorem. None of these will ever be used or discussed again, as almost all statistical models used in practice are continuous.</p>
<p>The course then moves on to common summary statistics. This is generally taught by giving formulas for the mean, median, standard deviation, and variance, and explaining that the median should be used if you plot a histogram and it looks asymmetrical. A typical exam will here present a skewed histogram with the question “Which measure of central tendency would you compute from this data, the mean or the median?” This is exactly the kind of question that encourages the mindless parroting of trivia. Sure, the mean will be influenced by the skew in the data, but the sample mean is also – ya know – an unbiased estimator of the mean. The median is not (in general). What if I’m trying to estimate the population mean? What if I want to use my estimate in some bigger model? Is the distribution of the median consistent with my model’s assumptions? Or maybe I just want a robust estimate of the center of my data. Different goals will require different measures. Sure, these considerations are beyond the scope of two-weeks-into-an-intro-statistics-course, but talking with graduates of these courses never gives the impression that these complexities have been addressed at all. To students, the mean is the formula you use when your data are normalish. Otherwise, you use the other formula.</p>
<p>All courses must inevitably introduce hypothesis testing, which requires introducing the concept of a sampling distribution. This is hopeless. I am not aware of any literature actually quantifying student misunderstandings in this area, but have never in my life (and I have tried very hard) encountered a student, textbook, or instructor in the behavioral sciences with a correct, or even vaguely correct, understanding of the concept of a sampling distribution. How could it be otherwise? Consider the definition, and the depth of knowledge that it actually assumes:</p>
<p><em>A sampling distribution is the distribution of a statistic. </em></p>
<p>Now, approach this definition from the perspective of a student with no formal training in probability or statistics. Unpacking:</p>
<dl>
<dt>
A sampling distribution
</dt>
<dd>
<ul>
<li><p><em>Alright, so it’s some special kind of distribution, or maybe something different from a distribution? Why does it have a special name?</em> In reality, a sampling distribution is just a distribution. We just give it a special name when the random variable under consideration happens to have been computed from the data.</p>
</li></ul></dd>
<dt>
<p>is the distribution</p>
</dt>
<dd>
<ul>
<li><p>The student at this point has likely never seen a density function, let alone manipulated one. Distributions are abstract concepts that basically mean that the histogram of their data will have a particular shape to it. For example, data are normally distributed if the histogram is bell shaped. <em>The instructor says something about a mean, but I only have one mean! How can it be bell shaped? Apparently if I did a bunch of experiments it would be bell shaped, but I only did one.</em></p>
</li></ul></dd>
<dt>
<p>of a statistic</p>
</dt>
<dd>
<ul>
<li><p>A statistic is a function of the data, but this is simply never defined, or even alluded to. The sampling distribution is discussed only with reference to the mean. In fact, if you ask most students, they will reflexively identify the sampling distribution concept with the mean of a sample. The idea that, say, a median or any arbitrary function of the data has a sampling distribution is foreign to them. Many of them will <i>define</i> a sampling distribution as some variant of “the thing your mean comes from in a hypothesis test”</p>
</li></ul></dd>
</dl>



<p>For obvious reasons, this definition is never provided. Instead, the instructor will conduct a thought experiment in which we hypothetically collect data many times and plot the mean of each sample. This will, the central limit theorem assures us, look bell shaped. Researchers who have been immersed in statistics for most of their working lives might not appreciate just how abstract this “drawing many hypothetical samples” business really is, but to a student with no technical background, giving them only this vague handwavy hypothetical repeated experiment business just leaves them hopelessly lost in the dark. There’s nothing for them to grapple or reason with. Certainly, they can’t use it to extrapolate beyond what they’ve been taught.</p>
<p>Next, the instructor introduces a deeply important distinction. Up until now, in their ignorant savagery, the student has been dividing their sum of squared deviations from the mean by the sample size. This is called the <i>sample variance</i>, and it simply will not do for inference. For this, they must use the sum of squared deviations from the mean divided by the sample size <i>minus one</i>. This is called the <i>population variance</i>. This is perfectly sensible; after all, we’re interested in the population, so why not use the population variance? But what’s the difference? Well, one is the variance of the sample, and the other is the variance of the population. There will be mumbling about “degrees of freedom”, and how they lost one.</p>
<p>So, I computed the population variance of my data and it was 2.54. Does that mean it came from a population with variance 2.54? Well, no. The population variance is an <i>estimate</i> of the population variance. But does that mean the sample variance <i>isn’t</i>? Here, the student is told that the sample variance is biased. It tends to underestimate the population variance, while the population variance doesn’t. Logical, but the population variance will also be further away from the true variance, on average – it has a larger mean squared error than the sample variance. And what about standard deviation? The square root of the population variance is a biased estimate of the true standard deviation, so why do we prefer it over the square root of the sample variance? Of course, all of these properties assume that our data are normally distributed. If not, all bets are off. And all of these properties are moot when the sample size is reasonably large, since any minor difference between dividing by the sample size and dividing by the sample size minus one will be dwarfed by the measurement error and statistical uncertainty of the data. Sometimes, when I’m doing statistics in public, I like to use the sum of squared deviations from the mean divided by the sample size <i>plus one</i>, just to see people squirm.</p>
<p>The student is not equipped to understand any of this discussion because the student has never been introduced to the concept of an <i>estimator</i>. The fundamental problem of statistical inference is that our data have been generated by some process, and we want to compute something, <i>anything</i>, from the data that will give us knowledge of that process. If the process has a variance, we want to compute something that we hope will be reasonably close to that variance. We could conceivably compute <i>anything</i> – we just have to decide what properties we want our computation to have. We could want it to be right on average (unbiasedness), we could want it to be consistent across datasets (low variance), or as close as possible to the true value on average (low mean square error), or maybe robust to errors or contaminants in the data. We can choose whatever we want. The student has never been introduced to the concept of estimation – they’ve just been handed the concept of the “population variance” and told that it’s the thing they use when they’re trying to “generalize to the population”. In the future, as researchers, they don’t fully understand why they divide by the sample size minus one, they just know that it’s the proper thing to do.</p>
<p>There is a pithy way to summarize all this. Richard Feynman said the following in a 1974 address to Caltech:</p>
<blockquote class="blockquote">
In the South Seas there is a cargo cult of people. During the war they saw airplanes land with lots of good materials, and they want the same thing to happen now. So they’ve arranged to imitate things like runways, to put fires along the sides of the runways, to make a wooden hut for a man to sit in, with two wooden pieces on his head like headphones and bars of bamboo sticking out like antennas—he’s the controller—and they wait for the airplanes to land. They’re doing everything right. The form is perfect. It looks exactly the way it looked before. But it doesn’t work. No airplanes land. So I call these things cargo cult science, because they follow all the apparent precepts and forms of scientific investigation, but they’re missing something essential, because the planes don’t land.
</blockquote>
<p>Cargo cults occur when when a group imitates the aesthetics and rituals of a discipline without understanding the reasons behind them. Cargo cult statistics happens when students and researchers misinterpret the fuzzy conceptual descriptions of statistical procedures they learned as undergraduates as being literally or universally true. This usually results in a rule of thumb or layman’s description becoming morphed into a concrete statistical rule.</p>
<p>“<strong>We usually divide by the sample size minus one when estimating a normal variance because it’s unbiased</strong>” becomes “<strong>You only divide by the sample size when you want to summarize your data. If you want to generalize to a population, you have to subtract one</strong>”. That many valid estimators of a normal variance exist, and that any one of them can be selected depending on the properties desired by the researcher, is lost on the student.</p>
<p>“<strong>A main effect in a regression model describes the predicted change in the independent variable per unit change in the corresponding predictor when all other predictors are held constant</strong>” becomes “<strong>A main effect in a regression model is the effect of a predictor controlling for the other variables</strong>”. This leads to the dangerous idea that you can somehow “control” for a variable by including it in a regression model. In reality, the first line of control is always in the data collection process. Regression models assume very specific functional relationships between the predictors and the independent variables, and the distinction between “controlling” and “holding constant” is important.</p>
<p>“<strong>A result this extreme probably wouldn’t occur under the null hypothesis</strong>” becomes “<strong>the null hypothesis is probably false</strong>”. So much has been written about this misunderstanding that it needs no further discussion.</p>
<p>General statistical concepts become conflated with one of their specific incarnations. Factor analysis assumes multivariate normality and is often estimated by maximum likelihood. I have been challenged several times by students who have studied factor analysis for using maximum likelihood to estimate other statistical models. You can’t use maximum likelihood to estimate a binomial probability, I have been told, because maximum likelihood assumes that the data are normal, and coin flips are not normal. Similarly, “least squares” and “linear regression” are synonymous. There is no distinction between a statistical model and the method used to estimate its parameters.</p>
<p>The word “population” is used with an almost mythical vagueness, and the ability to generalize to it possessed by only the most sophisticated of models. Consider the concepts of “fixed” and “random” effects, which are given incomprehensible explanations like “<strong>An effect is fixed if you have specified all possible levels of the effect, and random if the effects were randomly sampled from a population, or if some levels of the effects are unknown</strong>”. This inevitably followed by “<strong>fixed effect models don’t let you generalize to the population</strong>”. This is statistical gibberish, and is symptomatic of a general failure of universities to teach statistical modelling. Students do not understand that they can hypothesize any relationships they want between their variables, and formalize those relationships in the form of a statistical model. Instead, statistics is a set of procedures. If you have groups, you do an ANOVA. If your variables are continuous, you do a regression. If you want to say something about the “population”, you have to use a specific kind of regression called random effects. Fixed effects doesn’t have the “generalize to population” property. Of course, there is nothing built into either class of model that suggests such a thing. One type of model assumes that some coefficients have a particular distributional structure, whereas the other does not. Which one the researcher uses depends entirely on what they believe to be true about their data.</p>
<p>The sciences are filled with this kind of “folk wisdom” that has no real statistical or mathematical basis, but is widely believed and taught simply because it was the easiest thing for the student to grapple with when faced with the otherwise overwhelming vagary and abstraction that is statistics without any rigor or technical background. The student certainly can’t be expected to reason with or derive any concrete knowledge from “doing hypothetical experiments lots of times to get a normal distribution”, and so their understanding ends up crystallizing as a set of steps and guidelines that they vaguely remember but don’t remember why, like “divide by the sample size minus one so that I can generalize to the population”. Many university departments have not had any contact with a statistics or mathematics department in decades, and so students are taught by former students of former students who themselves have the same vague understanding.</p>
<p>As a result of all this, if you ask a student or researcher to provide a correct definition of the p-value, they cannot. The solution to this problem, says hundreds of articles in Nature or Psychological Science or the Journal of Personality and Social Psychology, is to provide them with the correct definition. But this is plainly useless – a researcher with a flawed understanding of one of the most widely used and fundamental concepts in applied statistics will not be made whole again by providing them with the proper definition of a p-value. And the solution is <i>certainly</i> not to provide them with even more dangerous machinery, like a Bayes factor or a posterior distribution. The whole foundation has to be removed and replaced.</p>
<h3 class="anchored">
References
</h3>
<p style="margin-left:.5in;text-indent:-.5in">
</p><p>Haller, H., &amp; Krauss, S. (2002). Misinterpretations of significance: A problem students share with their teachers. <i>Methods of Psychological Research</i>, 7(1), 1-20.</p>
<p style="margin-left:.5in;text-indent:-.5in">
</p><p>Sotos, A. E. C., Vanhoof, S., Van den Noortgate, W., &amp; Onghena, P. (2007). Students’ misconceptions of statistical inference: A review of the empirical evidence from research on statistics education. <i>Educational Research Review</i>, 2(2), 98-113.</p>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>